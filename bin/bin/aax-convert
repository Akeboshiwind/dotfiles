#!/bin/sh
# aax-convert


# >> Utils

usage() {
    cat << USAGE
Usage: aax-convert [OPTIONS] input-file [output-file]

Options:
    -h, --help                   Display this help and exit
    --version                    Output the version information and exit

Examples:
    aax-convert foo.aax          Output 'output.mp4'
    aax-convert foo.aax foo.mp4  Output 'foo.mp4'

Report bugs to <olivershawmarshall+dotfiles@gmail.com>.
USAGE
}

version() {
    cat << VERSION
aax-convert 1.2

Copyright (C) 2019 Oliver Marshall

Written by Oliver Marshall.
VERSION
}



# >> Cli args

while [ "$1" != "" ]; do
    case $1 in
        -h | --help )        usage
                             exit
                             ;;
        --version )          version
                             exit
                             ;;
        * )                  break
    esac
    shift
done

input_file=$1
output_file=${2:-output.mp4}



# >> Validate input

if [ -z "$input_file" ]; then
    echo "ERROR: No input file supplied\n"
    usage
    exit 1
fi



# >> Extract activation bytes

# See help message on where to get your 'activation bytes'
echo "INFO: Extracting activation byes from passwordstore"
activation_bytes="$(gopass show personal/amazon.co.uk activation-bytes)"



# >> Extract activation bytes

echo "INFO: Decoding the DRM protected file to an unprotected file"
ffmpeg -activation_bytes $activation_bytes -i $input_file -c copy $output_file

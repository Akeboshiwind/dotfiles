# Dotfiles

My personal dotfiles repo managed using [nix-darwin](https://nix-darwin.org/) and [home-manager](https://nix-community.github.io/home-manager/).



## Philosophy

The main philosophy is **simplicity**, in particular I've decided this means:
- A folder for each application
- Loose coupling between applications
- Be declarative
- Use the application's native config files
- Split config into multiple files where possible
- Comment liberally
- Use application defaults most of the time



## Setup

1. Create all the MacOS account you intend to
    - Ensure each is signed into the Mac App Store (so that [mas](https://github.com/mas-cli/mas) works)
2. Install nix using the [Determinate Systems Installer](https://determinate.systems/nix-installer/)
    - Make sure to install **vanilla Nix**
    - This only needs to happen on one of the accounts
3. Install [homebrew](https://brew.sh) on the user in `homebrew.user`
    - Currently `personal`
4. Run `sudo nix run nix-darwin/master#darwin-rebuild -- switch --flake ~/dotfiles`
    - This installs everything for both users



## Updating after config change

```sh
sudo darwin-rebuild switch --flake ~/dotfiles
```



## Trying out config changes

Home manager allows you to just run the build step:

```sh
sudo darwin-rebuild build --flake ~/dotfiles
```

This produces a `./result` symlink you can inspect:

```sh
ls result/
```

I couldn't see an easy way to inspect the files generated by home-manager.
One for future me :)



## Common errors

### `error: path '<nix store path to file you imported>' does not exist

Nix flakes require files to be tracked by the git repo.
Simply stage the file and the error should be fixed.



## Running tests

```sh
nix flake check
```



## Useful links

- [nix-darwin config](https://nix-darwin.github.io/nix-darwin/manual/index.html)
- [home-manager manual](https://nix-community.github.io/home-manager/index.xhtml#ch-writing-modules)
- [nix builtins + nixpkgs lib documentation viewer](https://teu5us.github.io/nix-lib.html)
- [Useful nix hacks](http://www.chriswarbo.net/projects/nixos/useful_hacks.html)
